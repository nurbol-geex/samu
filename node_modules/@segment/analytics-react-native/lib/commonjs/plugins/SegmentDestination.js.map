{"version":3,"names":["_plugin","require","_types","_util","_api","_DestinationMetadataEnrichment","_QueueFlushingPlugin","_constants","_errors","MAX_EVENTS_PER_BATCH","MAX_PAYLOAD_SIZE_IN_KB","SEGMENT_DESTINATION_KEY","exports","SegmentDestination","DestinationPlugin","type","PluginType","destination","key","constructor","promise","resolve","createPromise","settingsPromise","settingsResolve","sendEvents","events","length","Promise","config","analytics","getConfig","defaultConfig","chunkedEvents","chunk","maxBatchSize","sentEvents","numFailedEvents","all","map","batch","res","uploadEvents","writeKey","url","getEndpoint","checkResponseForErrors","concat","e","reportInternalError","translateHTTPError","logger","warn","queuePlugin","dequeue","debug","info","error","QueueFlushingPlugin","hasProxy","proxy","useSegmentEndpoints","Boolean","baseURL","endpoint","isProxyEndsWithSlash","endsWith","apiHost","defaultApiHost","getURL","console","configure","undefined","add","DestinationMetadataEnrichment","update","settings","_type","segmentSettings","integrations","execute","event","enrichedEvent","flush"],"sourceRoot":"../../../src","sources":["plugins/SegmentDestination.ts"],"mappings":"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"}
