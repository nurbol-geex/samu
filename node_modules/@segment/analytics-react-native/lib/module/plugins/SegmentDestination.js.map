{"version":3,"names":["DestinationPlugin","PluginType","chunk","createPromise","getURL","uploadEvents","DestinationMetadataEnrichment","QueueFlushingPlugin","defaultApiHost","checkResponseForErrors","translateHTTPError","defaultConfig","MAX_EVENTS_PER_BATCH","MAX_PAYLOAD_SIZE_IN_KB","SEGMENT_DESTINATION_KEY","SegmentDestination","type","destination","key","constructor","promise","resolve","settingsPromise","settingsResolve","sendEvents","events","length","Promise","config","analytics","getConfig","chunkedEvents","maxBatchSize","sentEvents","numFailedEvents","all","map","batch","res","writeKey","url","getEndpoint","concat","e","reportInternalError","logger","warn","queuePlugin","dequeue","debug","info","error","hasProxy","proxy","useSegmentEndpoints","Boolean","baseURL","endpoint","isProxyEndsWithSlash","endsWith","apiHost","console","configure","undefined","add","update","settings","_type","segmentSettings","integrations","execute","event","enrichedEvent","flush"],"sourceRoot":"../../../src","sources":["plugins/SegmentDestination.ts"],"mappings":"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"}
